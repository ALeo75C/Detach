<div class="productPage">
  <h1><%= @product.name %></h1>
  <div class="cover">
    <div class="image">
      <%= image_tag @product.image.url unless @product.image.url == nil %>
    </div>

    <div class="attention">
      <h1><%= @product.name %></h1>
      <% if @al > 0 %>
        <div class="block red">
          <%= image_tag asset_path("icons/productCharacter/badEvitation.png") %>
          <p>В составе содержатся компоненты, вызывающие аллергию</p>
        </div>
      <% else %>
        <div class="block green">
          <%= image_tag asset_path("icons/productCharacter/godEvitation.png") %>
          <p>В составе продеукта нет аллергенов</p>
        </div>
      <% end %>
      <% if @al < @product.active_effects.count %>
        <div class="block red">
          <%= image_tag asset_path("icons/productCharacter/badEffect.png") %>
          <p>Продукт может не соответствовать заявленным ожиданиям</p>
        </div>
      <% else %>
        <div class="block green">
          <%= image_tag asset_path("icons/productCharacter/godEffect.png") %>
          <p>Продукт полностью выполняет заявленные обещания</p>
        </div>
      <% end %>
      <div class="tags">
        <h4>Подходит для типов кожи</h4>
        <div class="tagList">
          <span>Нормальная</span>
          <span>Сухая</span>
          <span>Жирная</span>
          <span>Комбинированная</span>
        </div>
      </div>
      <div class="block">
        <%= image_tag asset_path("icons/productCharacter/test.png") %>
        <p>Продукт не тестирован на животных</p>
      </div>
      <div class="block">
        <%= image_tag asset_path("icons/productCharacter/eco.png") %>
        <p>Эко-упаковка</p>
      </div>
      <div class="buttuns">
        <% if can? :edit, @post %>
        <%= render "but", mes: "Редактировать", rout: edit_brand_product_path(@product.brand_id, @product.id), method: :get %>
        <% end %>
        <%= render "but", mes: "Сравнить цены", rout: edit_brand_product_path(@product.brand_id, @product.id), method: :get %>
        <% if current_user %>
          <%= render "but", mes: "Добавить в избранное", rout: profile_favorites_path(profile_id: current_user.profile.id, product_id: @product.id), method: :post %>
        <% else %>
          <%= render "but", mes: "Добавить в избранное", rout: new_user_session_path, method: :get %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="buttuns">
        <% if can? :edit, @post %>
          <%= render "but", mes: "Редактировать", rout: edit_brand_product_path(@product.brand_id, @product.id), method: :get %>
        <% end %>
          <%= render "but", mes: "Сравнить цены", rout: edit_brand_product_path(@product.brand_id, @product.id), method: :get %>
        <% if current_user %>
          <%= render "but", mes: "Добавить в избранное", rout: profile_favorites_path(profile_id: current_user.profile.id, product_id: @product.id), method: :post %>
        <% else %>
          <%= render "but", mes: "Добавить в избранное", rout: new_user_session_path, method: :get %>
        <% end %>
      </div>
  <div class="content">
    <h2>Описание продукта</h2>
    <p><%= @product.description %></p>
    <div class="structure">
      <div class="table">
        <h2>Свойства</h2>

        <div class="t_head">
          <h2>Обещание</h2>
          <h2>Компонент</h2>
          <h2>Эффективность</h2>
        </div>

        <div class="t_body">
          <% @product.active_effects.all.each do |prom| %>
          <div class="block">
            <% i = 0 %>
            <div class="promist">
              <h3><%= pr = prom.name %></h3>
            </div>
            <div class="components">
              <% @product.components.each do |comp| %>
                <% comp.active_effects.each do |ef| %>
                  <% if ef.name == pr %>
                    <div class="component">
                      <h4><%= comp.name %></h4>
                    </div>
                    <% i += 1 %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <div class="result">
              <% if i > 0 %>
              <p>Да. Имеет хорошие ингредиенты которые отвечают заявленному обущанию</p>
              <% else %>
              <p>Нет. Эффективные ингредиенты отсутствуют или их концентрация слишком низкая</p>
              <% end %>
            </div>
          </div>
          <% end %>
        </div>

      </div>

      <div class="list">
        <h2>Состав</h2>
        <% @product.structure.each do |point|%>
          <% c = Component.find(point.component_id) %>
          <div class="line">
            <% if point.role == "Active" %>
              <h3 class = "Active"><%= c.name %></h3>
            <% elsif point.role == "Form" %>
              <h3 class = "Form"><%= c.name %></h3>
            <% else %>
              <h3 class = "Eritate"><%= c.name %></h3>
            <% end %>
            <p><%= c.description %></p>
          </div>
        <% end %>
      </div>

      <div class="graph">
        <h2>Анализ состава</h2>

        <% all = @product.structure.count %>
        <% @al = (@al * 100 / all) %>
        <% @ac = (@ac * 100 / all) %>
        <% @fo = (@fo * 100 / all) %>
        <% @er = (@er * 100 / all) %>

        <% i = 0 %>
        <% 4.times do %>
          <div class="point">
            <% if i == 0 %>
              <% value = @ac %>
              <h3>Нераздражающие вещества</h3>
              <div class="info">
                <p>Ингредиенты, обеспечивающие обещанный результат и не раздражающие кожу</p>
            <% elsif i == 1 %>
              <% value = @er %>
              <h3>Активные раздражители</h3>
              <div class="info">
                <p>Ингредиенты, которые раздражают и не приносят пользы коже</p>
            <% elsif i == 2 %>
              <% value = @al %>
              <h3>Аллергены</h3>
              <div class="info">
                <p>Ингредиенты, которые могут накапливаться в организме и вызывать аллергическую реакцию</p>
            <% else %>
              <% value = @fo %>
              <h3>Формула поддержки</h3>
              <div class="info">
                <p>Ингредиенты, добавляющиеся для текстуры продукта, чтобы помочь доставить другие ингридиенты</p>
            <% end %>
            <% if value > 100 %>
              <% value = 100 %>
            <% end %>
            <div class="bar">
              <% if value == 0 %>
                <div class="w-0"></div>
              <% elsif value < 10 %>
                <div class="w0"></div>
              <% elsif value < 20 %>
                <div class="w10"></div>
              <% elsif value < 30 %>
                <div class="w20"></div>
              <% elsif value < 40 %>
                <div class="w30"></div>
              <% elsif value < 50 %>
                <div class="w40"></div>
              <% elsif value < 60 %>
                <div class="w50"></div>
              <% elsif value < 70 %>
                <div class="w60"></div>
              <% elsif value < 80 %>
                <div class="w70"></div>
              <% elsif value < 90 %>
                <div class="w80"></div>
              <% elsif value < 100 %>
                <div class="w90"></div>
              <% elsif value >= 100 %>
                <div class="w100"></div>
              <% end %>
              <% if i == 0 %>
                <h3><%= value %>%</h3>
              <% elsif i == 1 %>
                <h3><%= value %>%</h3>
              <% elsif i == 2 %>
                <h3><%= value %>%</h3>
              <% else %>
                <h3><%= value %>%</h3>
              <% end %>
            </div>
          </div>
        </div>
          <% i = i + 1 %>
        <% end %>
      </div>

      <div class="comments">
        <h2>Отзывы</h2>
        <% if @product.comments.count != 0 %>
          <% @product.comments.each do |com| %>
          <p>
            <%= com.content %>
          </p>
          <% end %>
        <% else %>
          <h3>Отзывов пока нет</h3>
        <% end %>
        <% if current_user %>
          <%= render "but", mes: "Добвить отзыв", rout: new_product_comment_path(@product), method: :get %>
        <% end %>
      </div>
    </div>

    <div class="products">
      <h2>Вам может быть интерено</h2>
      <div class="cardsCollection">
        <% Product.all.sample(5).each do |el| %>
          <%= render "productCard", mod: el %>
        <% end %>
      </div>
    </div>
  </div>
</div>
